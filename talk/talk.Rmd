```{r setup, include=FALSE}
opts_chunk$set(tidy = FALSE) # preserve wrapped code
opts_chunk$set(dev = 'pdf') # size plots better
opts_chunk$set(fig.cap = "")
require(plyr)
require(ggplot2)
require(rdatamarket)
require(forecast)
```

# Introduction

## The Problem

### Tail Wagging the Dog

### The Scale of the Problem
* Formal Documents: Journal articles, books, book chapters, theses, consulting reports, etc.
* Informal documents: preliminary analyses, statistical homework
* Online content: web pages, blog posts, forum posts
* Browser metaphor versus page/slide-based metaphor


## The Solution

### Put it in an Email
* Written instructions
* Toolchains
* Workflow
* Open Source

### Toolchain
1.  Database
1.  Programming language
1.  Extentions to the programming language
    * convenience functions
    * advanced functions (e.g. forecasting)
    * charts
    * maps
1.  Collaboration
    * version control
    * open source
1.  Presentation
    * reports
    * slideshows
    * interactive charts
    * notebooks


### Toolchain: Presentation

### Open Source
* Documentation
* Support
* Extensibility

### Support
"The third problem in your code is, you are print()ing plots from R base graphics. Sigh. Printing base graphics does not make any sense."

### Workflow
LCFD -- Least Commonly Fouled-up Data
* L = Load
* C = Clean
* F = Functions
* D = Do

## Demo -- Database

### Database (SQLite)

# Demo

## Basics

### Basic Programming
```{r}
1 + 1
mean(c(1, 3, 5, 8, 10))
```

### Load/Visualize Data

```{r}
head(baseball[, c("id", "year"  
                  , "stint", "team", "rbi")])
```

### Manipulate Data
```{r manipulate}
rbi <- ddply(baseball, .(year), summarise,  
  mean_rbi = mean(rbi, na.rm = TRUE))
head(rbi)
```

### Basic Plots
```{r basicPlot, fig.width = 4, fig.height = 2.5, fig.cap = "mean rbi by year"}
qplot(year, mean_rbi, data = rbi, geom = "line")
```

### Plots you can't do in Excel
```{r nonExcelPlot, message = FALSE, warning = FALSE, fig.width = 4, fig.height = 2.5, fig.cap = "mean rbi by year"}
qplot(year, mean_rbi, data = rbi, geom = "line") +
    geom_smooth()
```

## Time-series Forecasting

### Easy Timeseries

```{r gas, echo = FALSE, fig.width = 4, fig.height = 3.5, cache = TRUE}
plot(forecast(gas), main = "Australian monthly gas production")
```

### Easy Timeseries

```{r gasDecompose, echo = FALSE, fig.width = 4, fig.height = 3.5, cache = TRUE}
plot(stl(gas, "periodic"))
```

### Difficult Timeseries
```{r setupBeer, echo = FALSE}
# beer production
dminit("4b3320aa36214e35a7d0c6c175a1ff98") # rdatamarket api key
beer <- dmlist("22ry") # download
beer$Year <- as.numeric(substr(as.character(beer$Quarter), 1, 4)) # extract year from quarter
annual <- ddply(beer[1:152, ], .(Year), summarize, Production = sum(Value)) # summarize by year
# forecast with forecast package
goodForecast <- forecast(as.ts(annual[1:34, "Production"]), h = 4)
goodConfidence <- data.frame(goodForecast$upper, goodForecast$lower)
goodForecast <- data.frame(Year = seq(1990, 1993), Production = goodForecast$mean) # df for ggplot
# forecast with simple regression
production <- annual[1:34, "Production"]
year <- annual[1:34, "Year"]
poorForecast <- lm(production ~ year) 
pred <- predict(poorForecast, data.frame(year = seq(1990, 1993))) # four-year forecast
poorForecast <- data.frame(Year = c(poorForecast$model$year, seq(1990, 1993))
                           , Production <- c(poorForecast$fitted.values, pred))
# preapre plot (plain data to begin with)
p <- ggplot() + xlim(range(annual$Year)) + 
  ylim(range(c(annual$Production, goodForecast$Production, poorForecast$Production, goodConfidence$X2))) + 
  geom_line(data = annual[1:34, ], aes(Year, Production)) + 
  theme(legend.position="none")
```

```{r BeerInvisible, echo = FALSE, fig.width = 4, fig.height = 3}
p
```

### Difficult Timeseries
```{r BeerVisible, echo = FALSE, fig.width = 4, fig.height = 3}
p <- p + labs(title="Australian Annual Beer Production")
p
```

### Difficult Timeseries
```{r BeerForecast1, echo = FALSE, fig.width = 4, fig.height = 3}
p <- p + geom_line(aes(Year, Production),  poorForecast, colour = "red")
p
```

### Difficult Timeseries
```{r BeerForecast2, echo = FALSE, fig.width = 4, fig.height = 3}
p <- p + geom_line(aes(Year, Production), goodForecast, colour = "blue") +
  geom_ribbon(data=goodConfidence,aes(x = seq(1990, 1993), ymax = X1, ymin=X1.1), alpha=0.2)
p
```

### Difficult Timeseries
```{r BeerForecast3, echo = FALSE, fig.width = 4, fig.height = 3}
p <- p + geom_line(aes(Year, Production), annual[34:38, ], colour = "darkgreen")
p
```


# Impossible

### Maps
```{r map, fig.width = 4, fig.height = 2.8}
map("nz", mar = c(0,0,0,0))
```

### Facetted Plots
```{r mtcars, echo = FALSE, fig.width = 4, fig.height = 2.8}
ggplot(tips, aes(x=total_bill, fill = time)) +
  geom_density(alpha = 0.2) +
  facet_grid(sex ~ smoker, margins = TRUE) +
  xlab("") + ylab("") + 
  theme(axis.text = element_blank(), axis.ticks = element_blank())
```

### Diff
\includegraphics[width=4in]{figures/diff.png}

### Packages
\includegraphics[height=3in]{figures/packages.png}
When the blog was published on 2 May, the pink bar was lower than the orange bar.  But the orange bar was higher, too, so this is packages that were last updated each year.

### Maintainers
\includegraphics[height=3in]{figures/maintainers.png}

### Maintainers
```{r echo = FALSE, results='asis'}
x <- read.csv("maintainersShort.txt", header = FALSE)
colnames(x) <- c("Maintainer", "Position", "University")
print(xtable(x), size = "\\tiny", comment = FALSE)
```

### Links

* R on StackOverflow: <http://stackoverflow.com/questions/tagged/r>
* R Studio: <http://rstudio.org/>
* R Markdown with R Studio: <http://rstudio.org/docs/authoring/using_markdown>
* knitr: <http://yihui.name/knitr/>
* LaTeX: <http://tex.stackexchange.com/>
* Version Control for Data Analysts: <http://stackoverflow.com/questions/2712421/>

### Thank You

\begin{center}
\LARGE{Questions?}
\end{center}


