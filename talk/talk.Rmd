```{r setup, include=FALSE}
opts_chunk$set(tidy = FALSE) # preserve wrapped code
opts_chunk$set(dev = 'pdf') # size plots better
require(plyr)
require(ggplot2)
require(rdatamarket)
require(forecast)
```

# Introduction

## The Problem

### Tail Wagging the Dog

### The Scale of the Problem
* Formal Documents: Journal articles, books, book chapters, theses, consulting reports, etc.
* Informal documents: preliminary analyses, statistical homework
* Online content: web pages, blog posts, forum posts
* Browser metaphor versus page/slide-based metaphor


## The Solution

### Put it in an Email
* Written instructions
* Toolchains
* Open Source
* Workflow

### Toolchain: Data Analysis
1.  Database
1.  Programming language
1.  Extentions to the programming language
    * convenience functions
    * forecasting
    * charts
    * maps
    * interactive charts
    * presentation
    * notebooks

### Toolchain: Presentation

### Open Source
* Documentation
* Support
* Extensibility

### Workflow
LCFD -- Least Commonly Fouled-up Data
* L = Load
* C = Clean
* F = Functions
* D = Do

## Demo -- Database

### Database (SQLite)

# Demo

## Basics

### Basic Programming
```{r}
1 + 1
mean(c(1, 3, 5, 8, 10))
```

### Load/Visualize Data

```{r}
head(baseball[, c("id", "year"  
                  , "stint", "team", "rbi")])
```

### Manipulate Data
```{r manipulate}
rbi <- ddply(baseball, .(year), summarise,  
  mean_rbi = mean(rbi, na.rm = TRUE))
head(rbi)
```

### Basic Plots
```{r basicPlot, fig.width = 4, fig.height = 2.5, fig.cap = "mean rbi by year"}
qplot(year, mean_rbi, data = rbi, geom = "line")
```

### Plots you can't do in Excel
```{r nonExcelPlot, message = FALSE, warning = FALSE, fig.width = 4, fig.height = 2.5, fig.cap = "mean rbi by year"}
qplot(year, mean_rbi, data = rbi, geom = "line") +
    geom_smooth()
```

## Time-series Forecasting

### Easy Timeseries

```{r gas, echo = FALSE, fig.width = 4, fig.height = 3.5, fig.cap = "", cache = TRUE}
plot(forecast(gas), main = "Australian monthly gas production")
```

### Easy Timeseries

```{r gasDecompose, echo = FALSE, fig.width = 4, fig.height = 3.5, fig.cap = "", cache = TRUE}
plot(stl(gas, "periodic"))
```

### Difficult Timeseries
```{r setupBeer, echo = FALSE, comment = FALSE}
# beer production
dminit("4b3320aa36214e35a7d0c6c175a1ff98") # rdatamarket api key
beer <- dmlist("22ry") # download
beer$Year <- as.numeric(substr(as.character(beer$Quarter), 1, 4)) # extract year from quarter
annual <- ddply(beer[1:152, ], .(Year), summarize, Production = sum(Value)) # summarize by year
# forecast with forecast package
goodForecast <- forecast(as.ts(annual[1:34, "Production"]), h = 4)
goodConfidence <- data.frame(goodForecast$upper, goodForecast$lower)
goodForecast <- data.frame(Year = seq(1990, 1993), Production = goodForecast$mean) # df for ggplot
# forecast with simple regression
production <- annual[1:34, "Production"]
year <- annual[1:34, "Year"]
poorForecast <- lm(production ~ year) 
pred <- predict(poorForecast, data.frame(year = seq(1990, 1993))) # four-year forecast
poorForecast <- data.frame(Year = c(poorForecast$model$year, seq(1990, 1993))
                           , Production <- c(poorForecast$fitted.values, pred))
# preapre plot (plain data to begin with)
p <- ggplot() + xlim(range(annual$Year)) + 
  ylim(range(c(annual$Production, goodForecast$Production, poorForecast$Production, goodConfidence$X2))) + 
  geom_line(data = annual[1:34, ], aes(Year, Production)) + 
  theme(legend.position="none")
```

```{r BeerInvisible, echo = FALSE, fig.width = 4, fig.height = 3, fig.cap = ""}
p
```

### Difficult Timeseries
```{r BeerVisible, echo = FALSE, fig.width = 4, fig.height = 3, fig.cap = ""}
p <- p + labs(title="Australian Annual Beer Production")
p
```

### Difficult Timeseries
```{r BeerForecast1, echo = FALSE, fig.width = 4, fig.height = 3, fig.cap = ""}
p <- p + geom_line(aes(Year, Production),  poorForecast, colour = "red")
p
```

### Difficult Timeseries
```{r BeerForecast2, echo = FALSE, fig.width = 4, fig.height = 3, fig.cap = ""}
p <- p + geom_line(aes(Year, Production), goodForecast, colour = "blue") +
  geom_ribbon(data=goodConfidence,aes(x = seq(1990, 1993), ymax = X1, ymin=X1.1), alpha=0.2)
p
```

### Difficult Timeseries
```{r BeerForecast3, echo = FALSE, fig.width = 4, fig.height = 3, fig.cap = ""}
p <- p + geom_line(aes(Year, Production), annual[34:38, ], colour = "darkgreen")
p
```


### Links

* R on StackOverflow: <http://stackoverflow.com/questions/tagged/r>
* R Studio: <http://rstudio.org/>
* R Markdown with R Studio: <http://rstudio.org/docs/authoring/using_markdown>
* knitr: <http://yihui.name/knitr/>
* LaTeX: <http://tex.stackexchange.com/>

### Thank You

\begin{center}
\LARGE{Questions?}
\end{center}


